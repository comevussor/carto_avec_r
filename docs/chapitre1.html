<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapitre 1 Les données spatiales | Cartographie avec R</title>
  <meta name="description" content="Matériel pour le cours de cartographie avec R" />
  <meta name="generator" content="bookdown 0.19 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapitre 1 Les données spatiales | Cartographie avec R" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Matériel pour le cours de cartographie avec R" />
  <meta name="github-repo" content="rCarto/carto_avec_r" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapitre 1 Les données spatiales | Cartographie avec R" />
  
  <meta name="twitter:description" content="Matériel pour le cours de cartographie avec R" />
  

<meta name="author" content="Timothée Giraud &amp; Hugues Pecout" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="index.html"/>
<link rel="next" href="chapitre2.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/htmlwidgets-1.5.1/htmlwidgets.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/Proj4Leaflet-1.0.1/proj4-compressed.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.0.3/leaflet.js"></script>
<script src="libs/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js"></script>
<script src="libs/leaflet-providers-plugin-2.0.3/leaflet-providers-plugin.js"></script>
<link href="libs/HomeButton-0.0.1/home-button.css" rel="stylesheet" />
<script src="libs/HomeButton-0.0.1/home-button.js"></script>
<script src="libs/HomeButton-0.0.1/easy-button-src.min.js"></script>
<script src="libs/clipboard-0.0.1/setClipboardText.js"></script>
<link href="libs/PopupTable-0.0.1/popup.css" rel="stylesheet" />


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Cartographie avec R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Introduction</a></li>
<li class="chapter" data-level="1" data-path="chapitre1.html"><a href="chapitre1.html"><i class="fa fa-check"></i><b>1</b> Les données spatiales</a><ul>
<li class="chapter" data-level="1.1" data-path="chapitre1.html"><a href="chapitre1.html#le-package-sf"><i class="fa fa-check"></i><b>1.1</b> Le package <code>sf</code></a><ul>
<li class="chapter" data-level="1.1.1" data-path="chapitre1.html"><a href="chapitre1.html#format-des-objets-spatiaux-sf"><i class="fa fa-check"></i><b>1.1.1</b> Format des objets spatiaux <code>sf</code></a></li>
<li class="chapter" data-level="1.1.2" data-path="chapitre1.html"><a href="chapitre1.html#import-export"><i class="fa fa-check"></i><b>1.1.2</b> Import / Export</a></li>
<li class="chapter" data-level="1.1.3" data-path="chapitre1.html"><a href="chapitre1.html#affichage-de-données"><i class="fa fa-check"></i><b>1.1.3</b> Affichage de données</a></li>
<li class="chapter" data-level="1.1.4" data-path="chapitre1.html"><a href="chapitre1.html#joindre-des-données"><i class="fa fa-check"></i><b>1.1.4</b> Joindre des données</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="chapitre1.html"><a href="chapitre1.html#les-systèmes-de-projections"><i class="fa fa-check"></i><b>1.2</b> Les systèmes de projections</a><ul>
<li class="chapter" data-level="1.2.1" data-path="chapitre1.html"><a href="chapitre1.html#consulter-la-projection-dun-objet"><i class="fa fa-check"></i><b>1.2.1</b> Consulter la projection d’un objet</a></li>
<li class="chapter" data-level="1.2.2" data-path="chapitre1.html"><a href="chapitre1.html#modifier-la-projection-dun-objet"><i class="fa fa-check"></i><b>1.2.2</b> Modifier la projection d’un objet</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="chapitre1.html"><a href="chapitre1.html#opérations-de-géotraitement"><i class="fa fa-check"></i><b>1.3</b> Opérations de géotraitement</a><ul>
<li class="chapter" data-level="1.3.1" data-path="chapitre1.html"><a href="chapitre1.html#sélection-par-attributs"><i class="fa fa-check"></i><b>1.3.1</b> Sélection par attributs</a></li>
<li class="chapter" data-level="1.3.2" data-path="chapitre1.html"><a href="chapitre1.html#sélection-spatiale"><i class="fa fa-check"></i><b>1.3.2</b> Sélection spatiale</a></li>
<li class="chapter" data-level="1.3.3" data-path="chapitre1.html"><a href="chapitre1.html#extraire-des-centroides"><i class="fa fa-check"></i><b>1.3.3</b> Extraire des centroides</a></li>
<li class="chapter" data-level="1.3.4" data-path="chapitre1.html"><a href="chapitre1.html#créer-une-matrice-de-distances"><i class="fa fa-check"></i><b>1.3.4</b> Créer une matrice de distances</a></li>
<li class="chapter" data-level="1.3.5" data-path="chapitre1.html"><a href="chapitre1.html#agréger-des-polygones"><i class="fa fa-check"></i><b>1.3.5</b> Agréger des polygones</a></li>
<li class="chapter" data-level="1.3.6" data-path="chapitre1.html"><a href="chapitre1.html#agréger-des-polygones-en-fonction-dune-variable"><i class="fa fa-check"></i><b>1.3.6</b> Agréger des polygones en fonction d’une variable</a></li>
<li class="chapter" data-level="1.3.7" data-path="chapitre1.html"><a href="chapitre1.html#construire-une-zone-tampon"><i class="fa fa-check"></i><b>1.3.7</b> Construire une zone tampon</a></li>
<li class="chapter" data-level="1.3.8" data-path="chapitre1.html"><a href="chapitre1.html#réaliser-une-intersection"><i class="fa fa-check"></i><b>1.3.8</b> Réaliser une intersection</a></li>
<li class="chapter" data-level="1.3.9" data-path="chapitre1.html"><a href="chapitre1.html#compter-des-points-dans-un-polygone"><i class="fa fa-check"></i><b>1.3.9</b> Compter des points dans un polygone</a></li>
<li class="chapter" data-level="1.3.10" data-path="chapitre1.html"><a href="chapitre1.html#construire-des-polygones-de-voronoi"><i class="fa fa-check"></i><b>1.3.10</b> Construire des polygones de Voronoi</a></li>
<li class="chapter" data-level="1.3.11" data-path="chapitre1.html"><a href="chapitre1.html#construction-dobjets-sf"><i class="fa fa-check"></i><b>1.3.11</b> Construction d’objets sf</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="chapitre1.html"><a href="chapitre1.html#géocodage-dadresses"><i class="fa fa-check"></i><b>1.4</b> Géocodage d’adresses</a></li>
<li class="chapter" data-level="1.5" data-path="chapitre1.html"><a href="chapitre1.html#importer-des-données-osm"><i class="fa fa-check"></i><b>1.5</b> Importer des données OSM</a></li>
<li class="chapter" data-level="1.6" data-path="chapitre1.html"><a href="chapitre1.html#exercices"><i class="fa fa-check"></i><b>1.6</b> Exercices</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="chapitre2.html"><a href="chapitre2.html"><i class="fa fa-check"></i><b>2</b> Cartographie thématique</a><ul>
<li class="chapter" data-level="2.1" data-path="chapitre2.html"><a href="chapitre2.html#le-package-cartography"><i class="fa fa-check"></i><b>2.1</b> Le package <code>cartography</code></a></li>
<li class="chapter" data-level="2.2" data-path="chapitre2.html"><a href="chapitre2.html#représentations-usuelles"><i class="fa fa-check"></i><b>2.2</b> Représentations usuelles</a><ul>
<li class="chapter" data-level="2.2.1" data-path="chapitre2.html"><a href="chapitre2.html#carte-de-symboles-proportionnels"><i class="fa fa-check"></i><b>2.2.1</b> Carte de symboles proportionnels</a></li>
<li class="chapter" data-level="2.2.2" data-path="chapitre2.html"><a href="chapitre2.html#carte-choroplèthe"><i class="fa fa-check"></i><b>2.2.2</b> Carte choroplèthe</a></li>
<li class="chapter" data-level="2.2.3" data-path="chapitre2.html"><a href="chapitre2.html#carte-de-typologie"><i class="fa fa-check"></i><b>2.2.3</b> Carte de typologie</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="chapitre2.html"><a href="chapitre2.html#combinaisons-de-représentations"><i class="fa fa-check"></i><b>2.3</b> Combinaisons de représentations</a><ul>
<li class="chapter" data-level="2.3.1" data-path="chapitre2.html"><a href="chapitre2.html#carte-de-stocks-et-de-ratios"><i class="fa fa-check"></i><b>2.3.1</b> Carte de stocks et de ratios</a></li>
<li class="chapter" data-level="2.3.2" data-path="chapitre2.html"><a href="chapitre2.html#carte-de-stocks-et-de-qualitative"><i class="fa fa-check"></i><b>2.3.2</b> Carte de stocks et de qualitative</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="chapitre2.html"><a href="chapitre2.html#mise-en-page"><i class="fa fa-check"></i><b>2.4</b> Mise en page</a><ul>
<li class="chapter" data-level="2.4.1" data-path="chapitre2.html"><a href="chapitre2.html#habillage-complet"><i class="fa fa-check"></i><b>2.4.1</b> Habillage complet</a></li>
<li class="chapter" data-level="2.4.2" data-path="chapitre2.html"><a href="chapitre2.html#flèche-dorientation"><i class="fa fa-check"></i><b>2.4.2</b> Flèche d’orientation</a></li>
<li class="chapter" data-level="2.4.3" data-path="chapitre2.html"><a href="chapitre2.html#échelle"><i class="fa fa-check"></i><b>2.4.3</b> Échelle</a></li>
<li class="chapter" data-level="2.4.4" data-path="chapitre2.html"><a href="chapitre2.html#étiquettes"><i class="fa fa-check"></i><b>2.4.4</b> Étiquettes</a></li>
<li class="chapter" data-level="2.4.5" data-path="chapitre2.html"><a href="chapitre2.html#ajuster-les-marges-dune-figure"><i class="fa fa-check"></i><b>2.4.5</b> Ajuster les marges d’une figure</a></li>
<li class="chapter" data-level="2.4.6" data-path="chapitre2.html"><a href="chapitre2.html#centrer-la-carte-sur-une-région"><i class="fa fa-check"></i><b>2.4.6</b> Centrer la carte sur une région</a></li>
<li class="chapter" data-level="2.4.7" data-path="chapitre2.html"><a href="chapitre2.html#afficher-plusieurs-cartes-sur-la-même-figure"><i class="fa fa-check"></i><b>2.4.7</b> Afficher plusieurs cartes sur la même figure</a></li>
<li class="chapter" data-level="2.4.8" data-path="chapitre2.html"><a href="chapitre2.html#obtenir-un-ratio-de-figure-adapté"><i class="fa fa-check"></i><b>2.4.8</b> Obtenir un ratio de figure adapté</a></li>
<li class="chapter" data-level="2.4.9" data-path="chapitre2.html"><a href="chapitre2.html#ajouter-une-image-sur-une-carte"><i class="fa fa-check"></i><b>2.4.9</b> Ajouter une image sur une carte</a></li>
<li class="chapter" data-level="2.4.10" data-path="chapitre2.html"><a href="chapitre2.html#placer-précisément-un-élément-sur-la-carte"><i class="fa fa-check"></i><b>2.4.10</b> Placer précisément un élément sur la carte</a></li>
<li class="chapter" data-level="2.4.11" data-path="chapitre2.html"><a href="chapitre2.html#utiliser-un-fond-de-carte-osm"><i class="fa fa-check"></i><b>2.4.11</b> Utiliser un fond de carte OSM</a></li>
<li class="chapter" data-level="2.4.12" data-path="chapitre2.html"><a href="chapitre2.html#créer-un-effet-crayonné"><i class="fa fa-check"></i><b>2.4.12</b> Créer un effet crayonné</a></li>
<li class="chapter" data-level="2.4.13" data-path="chapitre2.html"><a href="chapitre2.html#ajouter-un-ombrage-à-une-couche"><i class="fa fa-check"></i><b>2.4.13</b> Ajouter un ombrage à une couche</a></li>
<li class="chapter" data-level="2.4.14" data-path="chapitre2.html"><a href="chapitre2.html#création-de-cartons"><i class="fa fa-check"></i><b>2.4.14</b> Création de cartons</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="chapitre2.html"><a href="chapitre2.html#exercices-1"><i class="fa fa-check"></i><b>2.5</b> Exercices</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="chapitre3.html"><a href="chapitre3.html"><i class="fa fa-check"></i><b>3</b> Cartographie thématique avancée</a><ul>
<li class="chapter" data-level="3.1" data-path="chapitre3.html"><a href="chapitre3.html#les-cartes-de-discontinuités"><i class="fa fa-check"></i><b>3.1</b> Les cartes de discontinuités</a></li>
<li class="chapter" data-level="3.2" data-path="chapitre3.html"><a href="chapitre3.html#les-grilles-régulières"><i class="fa fa-check"></i><b>3.2</b> Les grilles régulières</a></li>
<li class="chapter" data-level="3.3" data-path="chapitre3.html"><a href="chapitre3.html#le-lissage-spatial"><i class="fa fa-check"></i><b>3.3</b> Le lissage spatial</a></li>
<li class="chapter" data-level="3.4" data-path="chapitre3.html"><a href="chapitre3.html#cartes-en-3d"><i class="fa fa-check"></i><b>3.4</b> Cartes en 3D</a><ul>
<li class="chapter" data-level="3.4.1" data-path="chapitre3.html"><a href="chapitre3.html#linemap"><i class="fa fa-check"></i><b>3.4.1</b> linemap</a></li>
<li class="chapter" data-level="3.4.2" data-path="chapitre3.html"><a href="chapitre3.html#relief-tanaka"><i class="fa fa-check"></i><b>3.4.2</b> Relief Tanaka</a></li>
<li class="chapter" data-level="3.4.3" data-path="chapitre3.html"><a href="chapitre3.html#rayshader"><i class="fa fa-check"></i><b>3.4.3</b> Rayshader</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="chapitre3.html"><a href="chapitre3.html#les-cartogrammes"><i class="fa fa-check"></i><b>3.5</b> Les cartogrammes</a><ul>
<li class="chapter" data-level="3.5.1" data-path="chapitre3.html"><a href="chapitre3.html#les-cartogrammes-de-dorling"><i class="fa fa-check"></i><b>3.5.1</b> Les cartogrammes de Dorling</a></li>
<li class="chapter" data-level="3.5.2" data-path="chapitre3.html"><a href="chapitre3.html#les-cartogrammes-non-continus"><i class="fa fa-check"></i><b>3.5.2</b> Les cartogrammes non continus</a></li>
<li class="chapter" data-level="3.5.3" data-path="chapitre3.html"><a href="chapitre3.html#les-cartogrammes-continus"><i class="fa fa-check"></i><b>3.5.3</b> Les cartogrammes continus</a></li>
<li class="chapter" data-level="3.5.4" data-path="chapitre3.html"><a href="chapitre3.html#forces-et-faiblesses-des-cartogrammes"><i class="fa fa-check"></i><b>3.5.4</b> Forces et faiblesses des cartogrammes</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="chapitre3.html"><a href="chapitre3.html#cartographie-interactive"><i class="fa fa-check"></i><b>3.6</b> Cartographie interactive</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="sessioninfo.html"><a href="sessioninfo.html"><i class="fa fa-check"></i><b>4</b> <code>sessionInfo()</code></a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rCarto/carto_avec_r" target="blank">Contribuer</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Cartographie avec R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="chapitre1" class="section level1">
<h1><span class="header-section-number">Chapitre 1</span> Les données spatiales</h1>
<p>Il est possible d’importer, de manipuler, de traiter, d’afficher et d’exporter des données spatiales avec R. La grande majorité des opérations de géotraitement sont disponibles dans R grace au package <code>sf</code>. Il devient alors possible d’utiliser R comme un SIG.</p>
<div id="le-package-sf" class="section level2">
<h2><span class="header-section-number">1.1</span> Le package <code>sf</code></h2>
<p><strong>Historique</strong><br />
Historiquement, trois packages permettent d’importer, de manipuler et de transformer les données spatiales :</p>
<ul>
<li>Le package <code>rgdal</code> qui est une interface entre R et les librairies GDAL (<a href="http://www.gdal.org/" target="_blank">Geospatial Data Abstraction Library</a>) et <a href="https://github.com/OSGeo/proj.4" target="_blank">PROJ4</a> permet d’importer et d’exporter les données spatiales (les shapefiles par exemple) et aussi de gérer les projections cartographiques<br />
</li>
<li>Le package <code>sp</code> fournit des classes et methodes pour les données spatiales dans R. Il permet afficher des fond de cartes, d’inspecter une table attributaire etc.<br />
</li>
<li>Le package <code>rgeos</code> donne accès à la librairie d’opérations spatiales GEOS (<a href="http://trac.osgeo.org/geos/" target="_blank">Geometry Engine - Open Source</a>) et rend donc disponible les opérations SIG classiques : calcul de surface ou de périmètre, calcul de distances, aggrégations spatiales, zones tampons, intersections etc.</li>
</ul>
<p><strong>La suite</strong><br />
Le package <code>sf</code> (<span class="citation">(Pebesma <a href="#ref-R-sf" role="doc-biblioref">2018</a><a href="#ref-R-sf" role="doc-biblioref">a</a>)</span>, <span class="citation">(Pebesma <a href="#ref-Pebesma18" role="doc-biblioref">2018</a><a href="#ref-Pebesma18" role="doc-biblioref">b</a>)</span>) a été publié fin 2016 par Edzer Pebesma (également auteur de <code>sp</code>). Son objectif est de combiner les fonctionnalités de <code>sp</code>, <code>rgeos</code> et <code>rgdal</code> dans un package unique plus ergonomique.
Ce package propose des objets plus simples (suivant le standard <a href="https://en.wikipedia.org/wiki/Simple_Features"><em>simple feature</em></a>) dont la manipulation est plus aisée. Une attention particulière a été portée à la compatibilité du package avec la syntaxe <em>pipe</em> et les opérateurs du <code>tidyverse</code>.</p>
<p>Aujourd’hui, les principaux développements dans l’écosystème spatial de R se détachent progressivement des 3 anciens (<code>sp</code>, <code>rgdal</code>, <code>rgeos</code>) pour se reposer sur <code>sf</code>.</p>
<div id="format-des-objets-spatiaux-sf" class="section level3">
<h3><span class="header-section-number">1.1.1</span> Format des objets spatiaux <code>sf</code></h3>
<p><img src="img/sf.png" width="562" style="display: block; margin: auto;" /></p>
<p>Les objets <code>sf</code> sont des <code>data.frame</code> dont l’une des colonnes contient des géométries. Cette colonne est de la classe sfc (simple feature column) et chaque individu de la colonne est un sfg (simple feature geometry).<br />
Ce format est très pratique dans la mesure ou les données et les géométries sont intrinsèquement liées dans un même objet.</p>
</div>
<div id="import-export" class="section level3">
<h3><span class="header-section-number">1.1.2</span> Import / Export</h3>
<p>Les fonctions <code>st_read()</code> et <code>st_write()</code> permettent d’importer et d’exporter de nombreux types de fichiers.<br />
Les lignes suivantes importent le fichier shapefile de la martinique situé dans un dossier <strong>data</strong>.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="chapitre1.html#cb2-1"></a><span class="kw">library</span>(sf)</span>
<span id="cb2-2"><a href="chapitre1.html#cb2-2"></a>mtq &lt;-<span class="st"> </span><span class="kw">st_read</span>(<span class="st">&quot;data/martinique.shp&quot;</span>, <span class="dt">quiet=</span><span class="ot">TRUE</span>)</span></code></pre></div>
<p>Les lignes suivantes exportent l’objet <strong>mtq</strong> dans un dossier <strong>data</strong> aux formats geopackage et shapefile.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="chapitre1.html#cb3-1"></a><span class="kw">st_write</span>(<span class="dt">obj =</span> mtq, <span class="dt">dsn =</span> <span class="st">&quot;data/mtq.gpkg&quot;</span>, <span class="dt">layer =</span> <span class="st">&quot;mtq&quot;</span>, <span class="dt">delete_layer =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>Deleting layer `mtq&#39; using driver `GPKG&#39;
Writing layer `mtq&#39; to data source `data/mtq.gpkg&#39; using driver `GPKG&#39;
Writing 34 features with 7 fields and geometry type Multi Polygon.</code></pre>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="chapitre1.html#cb5-1"></a><span class="kw">st_write</span>(<span class="dt">obj =</span> mtq, <span class="st">&quot;data/mtq.shp&quot;</span>, <span class="dt">delete_layer =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>Deleting layer `mtq&#39; using driver `ESRI Shapefile&#39;
Writing layer `mtq&#39; to data source `data/mtq.shp&#39; using driver `ESRI Shapefile&#39;
Writing 34 features with 7 fields and geometry type Multi Polygon.</code></pre>
<p>Pour importer le jeu de données proposé dans le package <code>cartography</code>, il faut installer le package puis utiliser le code suivant :</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="chapitre1.html#cb7-1"></a><span class="kw">install.packages</span>(<span class="st">&quot;cartography&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="chapitre1.html#cb8-1"></a><span class="kw">library</span>(sf)</span>
<span id="cb8-2"><a href="chapitre1.html#cb8-2"></a>mtq &lt;-<span class="st"> </span><span class="kw">st_read</span>(<span class="kw">system.file</span>(<span class="st">&quot;gpkg/mtq.gpkg&quot;</span>, <span class="dt">package=</span><span class="st">&quot;cartography&quot;</span>), <span class="dt">quiet =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
</div>
<div id="affichage-de-données" class="section level3">
<h3><span class="header-section-number">1.1.3</span> Affichage de données</h3>
<p><strong>Aperçu des variables</strong> via les fonctions <code>head()</code> et <code>plot()</code>.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="chapitre1.html#cb9-1"></a><span class="kw">head</span>(mtq)</span></code></pre></div>
<pre><code>Simple feature collection with 6 features and 7 fields
geometry type:  MULTIPOLYGON
dimension:      XY
bbox:           xmin: 695444 ymin: 1598818 xmax: 717731 ymax: 1645182
CRS:            32620
  INSEE_COM              STATUS            LIBGEO  POP   MED CHOM  ACT
1     97201 Simple municipality L&#39;Ajoupa-Bouillon 1902 13633  254  801
2     97202 Simple municipality Les Anses-d&#39;Arlet 3737 14558  425 1659
3     97203 Simple municipality      Basse-Pointe 3357 14456  400 1395
4     97204 Simple municipality         Le Carbet 3683 18847  285 1568
5     97205 Simple municipality       Case-Pilote 4458 21005  347 2096
6     97206 Simple municipality        Le Diamant 5976 19704  430 2654
                            geom
1 MULTIPOLYGON (((699261 1637...
2 MULTIPOLYGON (((709840 1599...
3 MULTIPOLYGON (((697602 1638...
4 MULTIPOLYGON (((702229 1628...
5 MULTIPOLYGON (((698805 1621...
6 MULTIPOLYGON (((709840 1599...</code></pre>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="chapitre1.html#cb11-1"></a><span class="kw">plot</span>(mtq)</span></code></pre></div>
<p><img src="Cartographie_avec_R_files/figure-html/unnamed-chunk-5-1.png" width="460.8" style="display: block; margin: auto;" /></p>
<p><strong>Affichage de la géométrie</strong> uniquement.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="chapitre1.html#cb12-1"></a><span class="kw">plot</span>(<span class="kw">st_geometry</span>(mtq))</span></code></pre></div>
<p><img src="Cartographie_avec_R_files/figure-html/unnamed-chunk-6-1.png" width="460.8" style="display: block; margin: auto;" /></p>
</div>
<div id="joindre-des-données" class="section level3">
<h3><span class="header-section-number">1.1.4</span> Joindre des données</h3>
<p>On peut joindre un <code>data.frame</code> à un objet sf en utilisant la fonction <code>merge()</code>.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="chapitre1.html#cb13-1"></a>mtq2016 &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="dt">file =</span> <span class="st">&quot;data/mtq2016.csv&quot;</span>)</span>
<span id="cb13-2"><a href="chapitre1.html#cb13-2"></a><span class="kw">head</span>(mtq2016)</span></code></pre></div>
<pre><code>     ID                NOM Population.totale
1 97201 L&#39; Ajoupa-Bouillon              1964
2 97202  Les Anses-d&#39;Arlet              3686
3 97203       Basse-Pointe              3238
4 97234      Bellefontaine              1760
5 97204          Le Carbet              3655
6 97205        Case-Pilote              4522</code></pre>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="chapitre1.html#cb15-1"></a>mtq &lt;-<span class="st"> </span><span class="kw">merge</span>(<span class="dt">x =</span> mtq, <span class="dt">y =</span> mtq2016, <span class="dt">by.x =</span> <span class="st">&quot;INSEE_COM&quot;</span>, <span class="dt">by.y =</span> <span class="st">&quot;ID&quot;</span>)</span>
<span id="cb15-2"><a href="chapitre1.html#cb15-2"></a><span class="kw">head</span>(mtq)</span></code></pre></div>
<pre><code>Simple feature collection with 6 features and 9 fields
geometry type:  MULTIPOLYGON
dimension:      XY
bbox:           xmin: 695444 ymin: 1598818 xmax: 717731 ymax: 1645182
CRS:            32620
  INSEE_COM              STATUS            LIBGEO  POP   MED CHOM  ACT                NOM
1     97201 Simple municipality L&#39;Ajoupa-Bouillon 1902 13633  254  801 L&#39; Ajoupa-Bouillon
2     97202 Simple municipality Les Anses-d&#39;Arlet 3737 14558  425 1659  Les Anses-d&#39;Arlet
3     97203 Simple municipality      Basse-Pointe 3357 14456  400 1395       Basse-Pointe
4     97204 Simple municipality         Le Carbet 3683 18847  285 1568          Le Carbet
5     97205 Simple municipality       Case-Pilote 4458 21005  347 2096        Case-Pilote
6     97206 Simple municipality        Le Diamant 5976 19704  430 2654         Le Diamant
  Population.totale                       geometry
1              1964 MULTIPOLYGON (((699261 1637...
2              3686 MULTIPOLYGON (((709840 1599...
3              3238 MULTIPOLYGON (((697602 1638...
4              3655 MULTIPOLYGON (((702229 1628...
5              4522 MULTIPOLYGON (((698805 1621...
6              5886 MULTIPOLYGON (((709840 1599...</code></pre>
</div>
</div>
<div id="les-systèmes-de-projections" class="section level2">
<h2><span class="header-section-number">1.2</span> Les systèmes de projections</h2>
<div id="consulter-la-projection-dun-objet" class="section level3">
<h3><span class="header-section-number">1.2.1</span> Consulter la projection d’un objet</h3>
<p>La fonction <code>st_crs()</code> permet de consulter le système de projection utilisé par un objet sf et de la modifier (<strong>sans reprojeter les données</strong>).</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="chapitre1.html#cb17-1"></a><span class="kw">st_crs</span>(mtq)</span></code></pre></div>
<pre><code>Coordinate Reference System:
  User input: 32620 
  wkt:
PROJCS[&quot;WGS 84 / UTM zone 20N&quot;,
    GEOGCS[&quot;WGS 84&quot;,
        DATUM[&quot;WGS_1984&quot;,
            SPHEROID[&quot;WGS 84&quot;,6378137,298.257223563,
                AUTHORITY[&quot;EPSG&quot;,&quot;7030&quot;]],
            AUTHORITY[&quot;EPSG&quot;,&quot;6326&quot;]],
        PRIMEM[&quot;Greenwich&quot;,0,
            AUTHORITY[&quot;EPSG&quot;,&quot;8901&quot;]],
        UNIT[&quot;degree&quot;,0.0174532925199433,
            AUTHORITY[&quot;EPSG&quot;,&quot;9122&quot;]],
        AUTHORITY[&quot;EPSG&quot;,&quot;4326&quot;]],
    PROJECTION[&quot;Transverse_Mercator&quot;],
    PARAMETER[&quot;latitude_of_origin&quot;,0],
    PARAMETER[&quot;central_meridian&quot;,-63],
    PARAMETER[&quot;scale_factor&quot;,0.9996],
    PARAMETER[&quot;false_easting&quot;,500000],
    PARAMETER[&quot;false_northing&quot;,0],
    UNIT[&quot;metre&quot;,1,
        AUTHORITY[&quot;EPSG&quot;,&quot;9001&quot;]],
    AXIS[&quot;Easting&quot;,EAST],
    AXIS[&quot;Northing&quot;,NORTH],
    AUTHORITY[&quot;EPSG&quot;,&quot;32620&quot;]]</code></pre>
</div>
<div id="modifier-la-projection-dun-objet" class="section level3">
<h3><span class="header-section-number">1.2.2</span> Modifier la projection d’un objet</h3>
<p>La fonction <code>st_transform()</code> permet de reprojeter un objet sf.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="chapitre1.html#cb19-1"></a><span class="kw">plot</span>(<span class="kw">st_geometry</span>(mtq))</span>
<span id="cb19-2"><a href="chapitre1.html#cb19-2"></a><span class="kw">title</span>(<span class="st">&quot;WGS 84 / UTM zone 20N&quot;</span>)</span></code></pre></div>
<p><img src="Cartographie_avec_R_files/figure-html/proj2-1.png" width="460.8" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="chapitre1.html#cb20-1"></a>mtq_reproj &lt;-<span class="st"> </span><span class="kw">st_transform</span>(mtq, <span class="dv">2154</span>)</span>
<span id="cb20-2"><a href="chapitre1.html#cb20-2"></a><span class="kw">plot</span>(<span class="kw">st_geometry</span>(mtq_reproj))</span>
<span id="cb20-3"><a href="chapitre1.html#cb20-3"></a><span class="kw">title</span>(<span class="st">&quot;RGF93 / Lambert-93&quot;</span>)</span></code></pre></div>
<p><img src="Cartographie_avec_R_files/figure-html/proj2-2.png" width="460.8" style="display: block; margin: auto;" />
Le site <a href="http://spatialreference.org/" target="_blank">Spatial Reference</a> met à disposition les références de très nombreux systèmes de projection.</p>
</div>
</div>
<div id="opérations-de-géotraitement" class="section level2">
<h2><span class="header-section-number">1.3</span> Opérations de géotraitement</h2>
<div id="sélection-par-attributs" class="section level3">
<h3><span class="header-section-number">1.3.1</span> Sélection par attributs</h3>
<p>Les objets <code>sf</code> <strong>sont</strong> des <code>data.frame</code>, on peut donc sélectionner leur lignes et leur colonnes de la même manière que les <code>data.frame</code>.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="chapitre1.html#cb21-1"></a><span class="co"># selection de ligne</span></span>
<span id="cb21-2"><a href="chapitre1.html#cb21-2"></a>mtq[<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>, ]</span></code></pre></div>
<pre><code>Simple feature collection with 2 features and 9 fields
geometry type:  MULTIPOLYGON
dimension:      XY
bbox:           xmin: 697602 ymin: 1598818 xmax: 710462 ymax: 1640653
CRS:            32620
  INSEE_COM              STATUS            LIBGEO  POP   MED CHOM  ACT                NOM
1     97201 Simple municipality L&#39;Ajoupa-Bouillon 1902 13633  254  801 L&#39; Ajoupa-Bouillon
2     97202 Simple municipality Les Anses-d&#39;Arlet 3737 14558  425 1659  Les Anses-d&#39;Arlet
  Population.totale                       geometry
1              1964 MULTIPOLYGON (((699261 1637...
2              3686 MULTIPOLYGON (((709840 1599...</code></pre>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="chapitre1.html#cb23-1"></a>mtq[mtq<span class="op">$</span>LIBGEO<span class="op">==</span><span class="st">&quot;Fort-de-France&quot;</span>, ]</span></code></pre></div>
<pre><code>Simple feature collection with 1 feature and 9 fields
geometry type:  MULTIPOLYGON
dimension:      XY
bbox:           xmin: 704269 ymin: 1614308 xmax: 711651 ymax: 1626937
CRS:            32620
  INSEE_COM     STATUS         LIBGEO   POP   MED  CHOM   ACT            NOM
9     97209 Prefecture Fort-de-France 82502 16927 10046 37615 Fort-de-France
  Population.totale                       geometry
9             82030 MULTIPOLYGON (((706345 1626...</code></pre>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="chapitre1.html#cb25-1"></a><span class="co"># selection de colonnes</span></span>
<span id="cb25-2"><a href="chapitre1.html#cb25-2"></a>mtq[mtq<span class="op">$</span>LIBGEO<span class="op">==</span><span class="st">&quot;Fort-de-France&quot;</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">4</span>]</span></code></pre></div>
<pre><code>Simple feature collection with 1 feature and 4 fields
geometry type:  MULTIPOLYGON
dimension:      XY
bbox:           xmin: 704269 ymin: 1614308 xmax: 711651 ymax: 1626937
CRS:            32620
  INSEE_COM     STATUS         LIBGEO   POP                       geometry
9     97209 Prefecture Fort-de-France 82502 MULTIPOLYGON (((706345 1626...</code></pre>
</div>
<div id="sélection-spatiale" class="section level3">
<h3><span class="header-section-number">1.3.2</span> Sélection spatiale</h3>
<p>Sélection des communes intesectant Fort-de-France</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="chapitre1.html#cb27-1"></a>fdf &lt;-<span class="st">  </span>mtq[mtq<span class="op">$</span>LIBGEO <span class="op">==</span><span class="st"> &quot;Fort-de-France&quot;</span>, ]</span>
<span id="cb27-2"><a href="chapitre1.html#cb27-2"></a>mtq<span class="op">$</span>fdf &lt;-<span class="st"> </span><span class="kw">st_intersects</span>(<span class="dt">x =</span> mtq, <span class="dt">y =</span> fdf, <span class="dt">sparse =</span> <span class="ot">FALSE</span>)</span>
<span id="cb27-3"><a href="chapitre1.html#cb27-3"></a><span class="kw">plot</span>(<span class="kw">st_geometry</span>(mtq))</span>
<span id="cb27-4"><a href="chapitre1.html#cb27-4"></a><span class="kw">plot</span>(<span class="kw">st_geometry</span>(mtq[mtq<span class="op">$</span>fdf,]), <span class="dt">col =</span> <span class="st">&quot;grey&quot;</span>, <span class="dt">add =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<p><img src="Cartographie_avec_R_files/figure-html/selectSpat-1.png" width="460.8" style="display: block; margin: auto;" /></p>
</div>
<div id="extraire-des-centroides" class="section level3">
<h3><span class="header-section-number">1.3.3</span> Extraire des centroides</h3>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="chapitre1.html#cb28-1"></a>mtq_c &lt;-<span class="st"> </span><span class="kw">st_centroid</span>(mtq)</span>
<span id="cb28-2"><a href="chapitre1.html#cb28-2"></a><span class="kw">plot</span>(<span class="kw">st_geometry</span>(mtq))</span>
<span id="cb28-3"><a href="chapitre1.html#cb28-3"></a><span class="kw">plot</span>(<span class="kw">st_geometry</span>(mtq_c), <span class="dt">add=</span><span class="ot">TRUE</span>, <span class="dt">cex=</span><span class="fl">1.2</span>, <span class="dt">col=</span><span class="st">&quot;red&quot;</span>, <span class="dt">pch=</span><span class="dv">20</span>)</span></code></pre></div>
<p><img src="Cartographie_avec_R_files/figure-html/centroid-1.png" width="460.8" style="display: block; margin: auto;" /></p>
</div>
<div id="créer-une-matrice-de-distances" class="section level3">
<h3><span class="header-section-number">1.3.4</span> Créer une matrice de distances</h3>
<p>Si le système de projection du jeu de données est renseigné les distances sont exprimées dans l’unité de mesure de la projection (en mètres le plus souvent).</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="chapitre1.html#cb29-1"></a>mat &lt;-<span class="st"> </span><span class="kw">st_distance</span>(<span class="dt">x =</span> mtq_c, <span class="dt">y =</span> mtq_c)</span>
<span id="cb29-2"><a href="chapitre1.html#cb29-2"></a>mat[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>,<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>]</span></code></pre></div>
<pre><code>Units: [m]
          [,1]     [,2]      [,3]      [,4]      [,5]
[1,]     0.000 35316.29  3019.561 12247.132 17181.321
[2,] 35316.293     0.00 38303.361 25478.399 18597.357
[3,]  3019.561 38303.36     0.000 15099.121 20200.611
[4,] 12247.132 25478.40 15099.121     0.000  7149.189
[5,] 17181.321 18597.36 20200.611  7149.189     0.000</code></pre>
</div>
<div id="agréger-des-polygones" class="section level3">
<h3><span class="header-section-number">1.3.5</span> Agréger des polygones</h3>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="chapitre1.html#cb31-1"></a>mtq_u &lt;-<span class="st"> </span><span class="kw">st_union</span>(mtq)</span>
<span id="cb31-2"><a href="chapitre1.html#cb31-2"></a><span class="kw">plot</span>(<span class="kw">st_geometry</span>(mtq), <span class="dt">col=</span><span class="st">&quot;lightblue&quot;</span>)</span>
<span id="cb31-3"><a href="chapitre1.html#cb31-3"></a><span class="kw">plot</span>(<span class="kw">st_geometry</span>(mtq_u), <span class="dt">add=</span>T, <span class="dt">lwd=</span><span class="dv">2</span>, <span class="dt">border =</span> <span class="st">&quot;red&quot;</span>)</span></code></pre></div>
<p><img src="Cartographie_avec_R_files/figure-html/aggreg-1.png" width="460.8" style="display: block; margin: auto;" /></p>
</div>
<div id="agréger-des-polygones-en-fonction-dune-variable" class="section level3">
<h3><span class="header-section-number">1.3.6</span> Agréger des polygones en fonction d’une variable</h3>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="chapitre1.html#cb32-1"></a>mtq_u2 &lt;-<span class="st"> </span><span class="kw">aggregate</span>(<span class="dt">x =</span> mtq[,<span class="kw">c</span>(<span class="st">&quot;POP&quot;</span>, <span class="st">&quot;CHOM&quot;</span>, <span class="st">&quot;ACT&quot;</span>)],</span>
<span id="cb32-2"><a href="chapitre1.html#cb32-2"></a>                    <span class="dt">by =</span> <span class="kw">list</span>(<span class="dt">STATUS =</span> mtq<span class="op">$</span>STATUS),</span>
<span id="cb32-3"><a href="chapitre1.html#cb32-3"></a>                    <span class="dt">FUN =</span> <span class="st">&quot;sum&quot;</span>)</span>
<span id="cb32-4"><a href="chapitre1.html#cb32-4"></a><span class="kw">plot</span>(mtq_u2[<span class="st">&quot;STATUS&quot;</span>], <span class="dt">key.pos =</span> <span class="ot">NULL</span>)</span></code></pre></div>
<p><img src="Cartographie_avec_R_files/figure-html/aggreg2-1.png" width="460.8" style="display: block; margin: auto;" /></p>
</div>
<div id="construire-une-zone-tampon" class="section level3">
<h3><span class="header-section-number">1.3.7</span> Construire une zone tampon</h3>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="chapitre1.html#cb33-1"></a>mtq_b &lt;-<span class="st"> </span><span class="kw">st_buffer</span>(<span class="dt">x =</span> mtq_u, <span class="dt">dist =</span> <span class="dv">2000</span>)</span>
<span id="cb33-2"><a href="chapitre1.html#cb33-2"></a><span class="kw">plot</span>(<span class="kw">st_geometry</span>(mtq), <span class="dt">col=</span><span class="st">&quot;lightblue&quot;</span>)</span>
<span id="cb33-3"><a href="chapitre1.html#cb33-3"></a><span class="kw">plot</span>(<span class="kw">st_geometry</span>(mtq_u), <span class="dt">add=</span>T, <span class="dt">lwd=</span><span class="dv">2</span>)</span>
<span id="cb33-4"><a href="chapitre1.html#cb33-4"></a><span class="kw">plot</span>(<span class="kw">st_geometry</span>(mtq_b), <span class="dt">add=</span>T, <span class="dt">lwd=</span><span class="dv">2</span>, <span class="dt">border =</span> <span class="st">&quot;red&quot;</span>)</span></code></pre></div>
<p><img src="Cartographie_avec_R_files/figure-html/buffers-1.png" width="460.8" style="display: block; margin: auto;" /></p>
</div>
<div id="réaliser-une-intersection" class="section level3">
<h3><span class="header-section-number">1.3.8</span> Réaliser une intersection</h3>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="chapitre1.html#cb34-1"></a>m &lt;-<span class="st"> </span><span class="kw">rbind</span>(<span class="kw">c</span>(<span class="dv">700015</span>,<span class="dv">1624212</span>), <span class="kw">c</span>(<span class="dv">700015</span>,<span class="dv">1641586</span>), <span class="kw">c</span>(<span class="dv">719127</span>,<span class="dv">1641586</span>), </span>
<span id="cb34-2"><a href="chapitre1.html#cb34-2"></a>           <span class="kw">c</span>(<span class="dv">719127</span>,<span class="dv">1624212</span>), <span class="kw">c</span>(<span class="dv">700015</span>,<span class="dv">1624212</span>))</span>
<span id="cb34-3"><a href="chapitre1.html#cb34-3"></a>p &lt;-<span class="st"> </span><span class="kw">st_sf</span>(<span class="kw">st_sfc</span>(<span class="kw">st_polygon</span>(<span class="kw">list</span>(m))), <span class="dt">crs =</span> <span class="kw">st_crs</span>(mtq))</span>
<span id="cb34-4"><a href="chapitre1.html#cb34-4"></a><span class="kw">plot</span>(<span class="kw">st_geometry</span>(mtq))</span>
<span id="cb34-5"><a href="chapitre1.html#cb34-5"></a><span class="kw">plot</span>(p, <span class="dt">border=</span><span class="st">&quot;red&quot;</span>, <span class="dt">lwd=</span><span class="dv">2</span>, <span class="dt">add=</span>T)</span></code></pre></div>
<p><img src="Cartographie_avec_R_files/figure-html/intersect-1.png" width="460.8" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="chapitre1.html#cb35-1"></a>mtq_z &lt;-<span class="st"> </span><span class="kw">st_intersection</span>(<span class="dt">x =</span> mtq, <span class="dt">y =</span> p)</span>
<span id="cb35-2"><a href="chapitre1.html#cb35-2"></a><span class="kw">plot</span>(<span class="kw">st_geometry</span>(mtq))</span>
<span id="cb35-3"><a href="chapitre1.html#cb35-3"></a><span class="kw">plot</span>(<span class="kw">st_geometry</span>(mtq_z), <span class="dt">col=</span><span class="st">&quot;red&quot;</span>, <span class="dt">border=</span><span class="st">&quot;green&quot;</span>, <span class="dt">add=</span>T)</span></code></pre></div>
<p><img src="Cartographie_avec_R_files/figure-html/intersect-2.png" width="460.8" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="chapitre1.html#cb36-1"></a><span class="kw">plot</span>(<span class="kw">st_geometry</span>(mtq_z))</span></code></pre></div>
<p><img src="Cartographie_avec_R_files/figure-html/intersect-3.png" width="460.8" style="display: block; margin: auto;" /></p>
</div>
<div id="compter-des-points-dans-un-polygone" class="section level3">
<h3><span class="header-section-number">1.3.9</span> Compter des points dans un polygone</h3>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="chapitre1.html#cb37-1"></a>pts &lt;-<span class="st"> </span><span class="kw">st_sample</span>(<span class="dt">x =</span> mtq, <span class="dt">size =</span> <span class="dv">50</span>)</span>
<span id="cb37-2"><a href="chapitre1.html#cb37-2"></a><span class="kw">plot</span>(<span class="kw">st_geometry</span>(mtq))</span>
<span id="cb37-3"><a href="chapitre1.html#cb37-3"></a><span class="kw">plot</span>(pts, <span class="dt">pch =</span> <span class="dv">20</span>, <span class="dt">col =</span> <span class="st">&quot;red&quot;</span>, <span class="dt">add=</span><span class="ot">TRUE</span>, <span class="dt">cex =</span> <span class="dv">1</span>)</span></code></pre></div>
<p><img src="Cartographie_avec_R_files/figure-html/intersect2-1.png" width="460.8" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="chapitre1.html#cb38-1"></a>inter &lt;-<span class="st"> </span><span class="kw">st_intersects</span>(mtq, pts)</span>
<span id="cb38-2"><a href="chapitre1.html#cb38-2"></a>mtq<span class="op">$</span>nbpts &lt;-<span class="st"> </span><span class="kw">sapply</span>(<span class="dt">X =</span> inter, <span class="dt">FUN =</span> length)</span>
<span id="cb38-3"><a href="chapitre1.html#cb38-3"></a><span class="kw">plot</span>(<span class="kw">st_geometry</span>(mtq))</span>
<span id="cb38-4"><a href="chapitre1.html#cb38-4"></a><span class="kw">plot</span>(<span class="kw">st_geometry</span>(mtq[mtq<span class="op">$</span>nbpts<span class="op">&gt;</span><span class="dv">2</span>,]), <span class="dt">col =</span> <span class="st">&quot;grey&quot;</span>, <span class="dt">add=</span><span class="ot">TRUE</span>)</span>
<span id="cb38-5"><a href="chapitre1.html#cb38-5"></a><span class="kw">plot</span>(pts, <span class="dt">pch =</span> <span class="dv">20</span>, <span class="dt">col =</span> <span class="st">&quot;red&quot;</span>, <span class="dt">add=</span><span class="ot">TRUE</span>, <span class="dt">cex =</span> <span class="dv">1</span>)</span></code></pre></div>
<p><img src="Cartographie_avec_R_files/figure-html/intersect2-2.png" width="460.8" style="display: block; margin: auto;" /></p>
</div>
<div id="construire-des-polygones-de-voronoi" class="section level3">
<h3><span class="header-section-number">1.3.10</span> Construire des polygones de Voronoi</h3>
<p>google: “st_voronoi R sf” (<a href="https://github.com/r-spatial/sf/issues/474" class="uri">https://github.com/r-spatial/sf/issues/474</a> &amp; <a href="https://stackoverflow.com/questions/45719790/create-voronoi-polygon-with-simple-feature-in-r" class="uri">https://stackoverflow.com/questions/45719790/create-voronoi-polygon-with-simple-feature-in-r</a>)</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="chapitre1.html#cb39-1"></a>mtq_v &lt;-<span class="st"> </span><span class="kw">st_voronoi</span>(<span class="dt">x =</span> <span class="kw">st_union</span>(mtq_c))</span>
<span id="cb39-2"><a href="chapitre1.html#cb39-2"></a>mtq_v &lt;-<span class="st"> </span><span class="kw">st_intersection</span>(<span class="kw">st_cast</span>(mtq_v), <span class="kw">st_union</span>(mtq))</span>
<span id="cb39-3"><a href="chapitre1.html#cb39-3"></a>mtq_v &lt;-<span class="st"> </span><span class="kw">st_join</span>(<span class="dt">x =</span> <span class="kw">st_sf</span>(mtq_v), <span class="dt">y =</span> mtq_c, <span class="dt">join=</span>st_intersects)</span>
<span id="cb39-4"><a href="chapitre1.html#cb39-4"></a>mtq_v &lt;-<span class="st"> </span><span class="kw">st_cast</span>(mtq_v, <span class="st">&quot;MULTIPOLYGON&quot;</span>)</span>
<span id="cb39-5"><a href="chapitre1.html#cb39-5"></a><span class="kw">plot</span>(<span class="kw">st_geometry</span>(mtq_v), <span class="dt">col=</span><span class="st">&#39;lightblue&#39;</span>)</span></code></pre></div>
<p><img src="Cartographie_avec_R_files/figure-html/voronoi-1.png" width="460.8" style="display: block; margin: auto;" /></p>
</div>
<div id="construction-dobjets-sf" class="section level3">
<h3><span class="header-section-number">1.3.11</span> Construction d’objets sf</h3>
<div id="points" class="section level4">
<h4><span class="header-section-number">1.3.11.1</span> POINTS</h4>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="chapitre1.html#cb40-1"></a><span class="kw">library</span>(sf)</span>
<span id="cb40-2"><a href="chapitre1.html#cb40-2"></a>pt1_sfg &lt;-<span class="st"> </span><span class="kw">st_point</span>(<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb40-3"><a href="chapitre1.html#cb40-3"></a>pt2_sfg &lt;-<span class="st"> </span><span class="kw">st_point</span>(<span class="kw">c</span>(<span class="dv">3</span>,<span class="dv">4</span>))</span>
<span id="cb40-4"><a href="chapitre1.html#cb40-4"></a>pt3_sfg &lt;-<span class="st"> </span><span class="kw">st_point</span>(<span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">1</span>))</span>
<span id="cb40-5"><a href="chapitre1.html#cb40-5"></a>(pt_sfc &lt;-<span class="st"> </span><span class="kw">st_sfc</span>(pt1_sfg,pt2_sfg,pt3_sfg, <span class="dt">crs =</span> (<span class="dv">4326</span>)))</span></code></pre></div>
<pre><code>Geometry set for 3 features 
geometry type:  POINT
dimension:      XY
bbox:           xmin: 1 ymin: 1 xmax: 3 ymax: 4
CRS:            EPSG:4326</code></pre>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="chapitre1.html#cb42-1"></a>pt_df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">id=</span> <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>), <span class="dt">cat =</span> <span class="kw">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;B&quot;</span>, <span class="st">&quot;A&quot;</span>), </span>
<span id="cb42-2"><a href="chapitre1.html#cb42-2"></a>                    <span class="dt">var1 =</span> <span class="kw">c</span>(<span class="dv">10</span>,<span class="dv">20</span>,<span class="dv">30</span>), <span class="dt">var2 =</span> <span class="kw">c</span>(<span class="fl">2.3</span>,<span class="fl">1.9</span>,<span class="dv">4</span>))</span>
<span id="cb42-3"><a href="chapitre1.html#cb42-3"></a>(pt_sf &lt;-<span class="st"> </span><span class="kw">st_sf</span>(pt_df,<span class="dt">geometry =</span> pt_sfc))</span></code></pre></div>
<pre><code>Simple feature collection with 3 features and 4 fields
geometry type:  POINT
dimension:      XY
bbox:           xmin: 1 ymin: 1 xmax: 3 ymax: 4
CRS:            EPSG:4326
  id cat var1 var2    geometry
1  1   A   10  2.3 POINT (1 2)
2  2   B   20  1.9 POINT (3 4)
3  3   A   30  4.0 POINT (2 1)</code></pre>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="chapitre1.html#cb44-1"></a><span class="kw">plot</span>(pt_sf)</span></code></pre></div>
<p><img src="Cartographie_avec_R_files/figure-html/unnamed-chunk-7-1.png" width="460.8" style="display: block; margin: auto;" /></p>
</div>
<div id="polygon" class="section level4">
<h4><span class="header-section-number">1.3.11.2</span> POLYGON</h4>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="chapitre1.html#cb45-1"></a>p1 &lt;-<span class="st"> </span><span class="kw">rbind</span>(<span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>), <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">0</span>), <span class="kw">c</span>(<span class="dv">3</span>,<span class="dv">2</span>), <span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">4</span>), <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">4</span>), <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>))</span>
<span id="cb45-2"><a href="chapitre1.html#cb45-2"></a>p2 &lt;-<span class="st"> </span><span class="kw">rbind</span>(<span class="kw">c</span>(<span class="dv">3</span>,<span class="dv">0</span>), <span class="kw">c</span>(<span class="dv">4</span>,<span class="dv">0</span>), <span class="kw">c</span>(<span class="dv">4</span>,<span class="dv">1</span>), <span class="kw">c</span>(<span class="dv">3</span>,<span class="dv">1</span>), <span class="kw">c</span>(<span class="dv">3</span>,<span class="dv">0</span>))</span>
<span id="cb45-3"><a href="chapitre1.html#cb45-3"></a>p3 &lt;-<span class="st"> </span><span class="kw">rbind</span>(<span class="kw">c</span>(<span class="dv">3</span>,<span class="dv">3</span>), <span class="kw">c</span>(<span class="dv">4</span>,<span class="dv">2</span>), <span class="kw">c</span>(<span class="dv">4</span>,<span class="dv">3</span>), <span class="kw">c</span>(<span class="dv">3</span>,<span class="dv">3</span>))</span>
<span id="cb45-4"><a href="chapitre1.html#cb45-4"></a>pol1_sfg &lt;-<span class="kw">st_polygon</span>(<span class="kw">list</span>(p1))</span>
<span id="cb45-5"><a href="chapitre1.html#cb45-5"></a>pol2_sfg &lt;-<span class="kw">st_polygon</span>(<span class="kw">list</span>(p2))</span>
<span id="cb45-6"><a href="chapitre1.html#cb45-6"></a>pol3_sfg &lt;-<span class="kw">st_polygon</span>(<span class="kw">list</span>(p3))</span>
<span id="cb45-7"><a href="chapitre1.html#cb45-7"></a>(pol_sfc &lt;-<span class="st"> </span><span class="kw">st_sfc</span>(pol1_sfg, pol2_sfg, pol3_sfg, <span class="dt">crs =</span> <span class="dv">4326</span>))</span></code></pre></div>
<pre><code>Geometry set for 3 features 
geometry type:  POLYGON
dimension:      XY
bbox:           xmin: 0 ymin: 0 xmax: 4 ymax: 4
CRS:            EPSG:4326</code></pre>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="chapitre1.html#cb47-1"></a>pol_df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">id=</span> <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>), <span class="dt">cat =</span> <span class="kw">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;B&quot;</span>, <span class="st">&quot;A&quot;</span>), </span>
<span id="cb47-2"><a href="chapitre1.html#cb47-2"></a>                     <span class="dt">var1 =</span> <span class="kw">c</span>(<span class="dv">10</span>,<span class="dv">20</span>,<span class="dv">30</span>), <span class="dt">var2 =</span> <span class="kw">c</span>(<span class="fl">2.3</span>,<span class="fl">1.9</span>,<span class="dv">4</span>))</span>
<span id="cb47-3"><a href="chapitre1.html#cb47-3"></a>(pol_sf &lt;-<span class="st"> </span><span class="kw">st_sf</span>(pol_df,<span class="dt">geometry =</span> pol_sfc))</span></code></pre></div>
<pre><code>Simple feature collection with 3 features and 4 fields
geometry type:  POLYGON
dimension:      XY
bbox:           xmin: 0 ymin: 0 xmax: 4 ymax: 4
CRS:            EPSG:4326
  id cat var1 var2                       geometry
1  1   A   10  2.3 POLYGON ((0 0, 1 0, 3 2, 2 ...
2  2   B   20  1.9 POLYGON ((3 0, 4 0, 4 1, 3 ...
3  3   A   30  4.0 POLYGON ((3 3, 4 2, 4 3, 3 3))</code></pre>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="chapitre1.html#cb49-1"></a><span class="kw">plot</span>(pol_sf)</span></code></pre></div>
<p><img src="Cartographie_avec_R_files/figure-html/unnamed-chunk-8-1.png" width="460.8" style="display: block; margin: auto;" /></p>
</div>
<div id="linestring" class="section level4">
<h4><span class="header-section-number">1.3.11.3</span> LINESTRING</h4>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="chapitre1.html#cb50-1"></a>p1 &lt;-<span class="st"> </span><span class="kw">rbind</span>(<span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>), <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">0</span>), <span class="kw">c</span>(<span class="dv">3</span>,<span class="dv">2</span>), <span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">4</span>), <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">4</span>))</span>
<span id="cb50-2"><a href="chapitre1.html#cb50-2"></a>p2 &lt;-<span class="st"> </span><span class="kw">rbind</span>(<span class="kw">c</span>(<span class="dv">3</span>,<span class="dv">0</span>), <span class="kw">c</span>(<span class="dv">4</span>,<span class="dv">0</span>), <span class="kw">c</span>(<span class="dv">4</span>,<span class="dv">1</span>), <span class="kw">c</span>(<span class="dv">3</span>,<span class="dv">1</span>))</span>
<span id="cb50-3"><a href="chapitre1.html#cb50-3"></a>p3 &lt;-<span class="st"> </span><span class="kw">rbind</span>(<span class="kw">c</span>(<span class="dv">3</span>,<span class="dv">3</span>), <span class="kw">c</span>(<span class="dv">4</span>,<span class="dv">2</span>), <span class="kw">c</span>(<span class="dv">4</span>,<span class="dv">3</span>))</span>
<span id="cb50-4"><a href="chapitre1.html#cb50-4"></a>ls1_sfg &lt;-<span class="kw">st_linestring</span>(p1)</span>
<span id="cb50-5"><a href="chapitre1.html#cb50-5"></a>ls2_sfg &lt;-<span class="kw">st_linestring</span>(p2)</span>
<span id="cb50-6"><a href="chapitre1.html#cb50-6"></a>ls3_sfg &lt;-<span class="kw">st_linestring</span>(p3)</span>
<span id="cb50-7"><a href="chapitre1.html#cb50-7"></a>(ls_sfc &lt;-<span class="st"> </span><span class="kw">st_sfc</span>(ls1_sfg, ls2_sfg, ls3_sfg, <span class="dt">crs =</span> <span class="dv">4326</span>))</span></code></pre></div>
<pre><code>Geometry set for 3 features 
geometry type:  LINESTRING
dimension:      XY
bbox:           xmin: 0 ymin: 0 xmax: 4 ymax: 4
CRS:            EPSG:4326</code></pre>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="chapitre1.html#cb52-1"></a>ls_df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">id=</span> <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>), <span class="dt">cat =</span> <span class="kw">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;B&quot;</span>, <span class="st">&quot;A&quot;</span>), </span>
<span id="cb52-2"><a href="chapitre1.html#cb52-2"></a>                    <span class="dt">var1 =</span> <span class="kw">c</span>(<span class="dv">10</span>,<span class="dv">20</span>,<span class="dv">30</span>), <span class="dt">var2 =</span> <span class="kw">c</span>(<span class="fl">2.3</span>,<span class="fl">1.9</span>,<span class="dv">4</span>))</span>
<span id="cb52-3"><a href="chapitre1.html#cb52-3"></a>(ls_sf &lt;-<span class="st"> </span><span class="kw">st_sf</span>(ls_df,<span class="dt">geometry =</span> ls_sfc))</span></code></pre></div>
<pre><code>Simple feature collection with 3 features and 4 fields
geometry type:  LINESTRING
dimension:      XY
bbox:           xmin: 0 ymin: 0 xmax: 4 ymax: 4
CRS:            EPSG:4326
  id cat var1 var2                       geometry
1  1   A   10  2.3 LINESTRING (0 0, 1 0, 3 2, ...
2  2   B   20  1.9 LINESTRING (3 0, 4 0, 4 1, ...
3  3   A   30  4.0     LINESTRING (3 3, 4 2, 4 3)</code></pre>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="chapitre1.html#cb54-1"></a><span class="kw">plot</span>(ls_sf)</span></code></pre></div>
<p><img src="Cartographie_avec_R_files/figure-html/unnamed-chunk-9-1.png" width="460.8" style="display: block; margin: auto;" /></p>
</div>
</div>
</div>
<div id="géocodage-dadresses" class="section level2">
<h2><span class="header-section-number">1.4</span> Géocodage d’adresses</h2>
<p>Plusieurs packages permettent de géocoder des adresses.</p>
<ul>
<li><code>photon</code> <span class="citation">(Giraud <a href="#ref-R-photon" role="doc-biblioref">2017</a><a href="#ref-R-photon" role="doc-biblioref">b</a>)</span>, utilise l’API de <a href="http://photon.komoot.de/">photon</a> qui
exploite les données d’OpenStreetMap. Ce package n’est pas sur le CRAN. Pour l’installer :</li>
</ul>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="chapitre1.html#cb55-1"></a><span class="kw">library</span>(remotes)</span>
<span id="cb55-2"><a href="chapitre1.html#cb55-2"></a><span class="kw">install_github</span>(<span class="dt">repo =</span> <span class="st">&#39;rCarto/photon&#39;</span>)  </span></code></pre></div>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="chapitre1.html#cb56-1"></a><span class="kw">library</span>(photon)</span>
<span id="cb56-2"><a href="chapitre1.html#cb56-2"></a>address &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;19 rue Michel Bakounine, 29600 Morlaix, France&quot;</span>,</span>
<span id="cb56-3"><a href="chapitre1.html#cb56-3"></a>             <span class="st">&quot;8 place Paul Ricoeur, 75013 Paris&quot;</span>)</span>
<span id="cb56-4"><a href="chapitre1.html#cb56-4"></a>place &lt;-<span class="st"> </span>photon<span class="op">::</span><span class="kw">geocode</span>(address, <span class="dt">limit =</span> <span class="dv">1</span>, <span class="dt">key =</span> <span class="st">&quot;place&quot;</span>, <span class="dt">lang =</span> <span class="st">&quot;fr&quot;</span>)</span>
<span id="cb56-5"><a href="chapitre1.html#cb56-5"></a>place</span></code></pre></div>
<pre><code>                                        location     osm_id osm_type name housenumber
1 19 rue Michel Bakounine, 29600 Morlaix, France 3241060871        N &lt;NA&gt;          19
2              8 place Paul Ricoeur, 75013 Paris 2608793979        N &lt;NA&gt;           8
                street postcode    city         state country osm_key osm_value       lon
1 Rue Michel Bakounine    29600 Morlaix      Bretagne  France   place     house -3.816435
2   Place Paul Ricoeur    75013   Paris Île-de-France  France   place     house  2.382483
       lat  msg
1 48.59041 &lt;NA&gt;
2 48.82670 &lt;NA&gt;</code></pre>
<ul>
<li><code>nominatim</code> <span class="citation">(Rudis <a href="#ref-R-nominatim" role="doc-biblioref">2019</a>)</span>, utilise l’API de
<a href="https://nominatim.openstreetmap.org/">nominatim</a> qui exploite les données
d’OpenStreetMap. Ce package n’est pas sur le CRAN. Une clef d’API est nécessaire
pour l’utiliser (<a href="https://developer.mapquest.com">obtenir une clef chez Maquest</a>).
Pour l’installer :</li>
</ul>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="chapitre1.html#cb58-1"></a><span class="kw">library</span>(remotes)</span>
<span id="cb58-2"><a href="chapitre1.html#cb58-2"></a><span class="kw">install_github</span>(<span class="dt">repo =</span> <span class="st">&#39;hrbrmstr/nominatim&#39;</span>)  </span></code></pre></div>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="chapitre1.html#cb59-1"></a><span class="kw">library</span>(nominatim)</span>
<span id="cb59-2"><a href="chapitre1.html#cb59-2"></a>address &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">URLencode</span>(<span class="st">&quot;19 rue Michel Bakounine, 29600 Morlaix, France&quot;</span>),</span>
<span id="cb59-3"><a href="chapitre1.html#cb59-3"></a>             <span class="kw">URLencode</span>(<span class="st">&quot;8 place Paul Ricoeur, 75013 Paris&quot;</span>))</span>
<span id="cb59-4"><a href="chapitre1.html#cb59-4"></a>place &lt;-<span class="st"> </span><span class="kw">osm_geocode</span>(address, </span>
<span id="cb59-5"><a href="chapitre1.html#cb59-5"></a>                     <span class="dt">country_codes =</span> <span class="st">&quot;FR&quot;</span>, </span>
<span id="cb59-6"><a href="chapitre1.html#cb59-6"></a>                     <span class="dt">key =</span> <span class="st">&quot;UneClefMapQuestValide&quot;</span>)</span>
<span id="cb59-7"><a href="chapitre1.html#cb59-7"></a>place</span></code></pre></div>
<pre><code>  place_id
1 44644129
2 27209988
                                                                               licence
1 Data © OpenStreetMap contributors, ODbL 1.0. https://www.openstreetmap.org/copyright
2 Data © OpenStreetMap contributors, ODbL 1.0. https://www.openstreetmap.org/copyright
  osm_type     osm_id      lat       lon
1     node 3241060871 48.59041 -3.816435
2     node 2608793979 48.82670  2.382483
                                                                                                   display_name
1 19, Rue Michel Bakounine, Ploujean, Kerozar, Morlaix, Finistère, Brittany, Metropolitan France, 29600, France
2    8, Place Paul Ricoeur, Gare, 13th Arrondissement, Paris, Ile-de-France, Metropolitan France, 75013, France
  class  type importance bbox_left bbox_top bbox_right bbox_bottom
1 place house      0.741  48.59036 48.59046  -3.816485   -3.816384
2 place house      0.631  48.82665 48.82675   2.382433    2.382533</code></pre>
<ul>
<li><code>banR</code> <span class="citation">(Gombin and Chevalier <a href="#ref-R-banR" role="doc-biblioref">2017</a>)</span>, pour des adresses en France uniquement.</li>
</ul>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="chapitre1.html#cb61-1"></a><span class="kw">library</span>(banR)</span>
<span id="cb61-2"><a href="chapitre1.html#cb61-2"></a>address &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;19 rue Michel Bakounine, 29600 Morlaix, France&quot;</span>,</span>
<span id="cb61-3"><a href="chapitre1.html#cb61-3"></a>             <span class="st">&quot;8 place Paul Ricoeur, 75013 Paris&quot;</span>)</span>
<span id="cb61-4"><a href="chapitre1.html#cb61-4"></a>place &lt;-<span class="st"> </span><span class="kw">geocode_tbl</span>(<span class="dt">tbl =</span> <span class="kw">data.frame</span>(address), <span class="dt">adresse =</span> <span class="st">&quot;address&quot;</span>)</span>
<span id="cb61-5"><a href="chapitre1.html#cb61-5"></a>place</span></code></pre></div>
<pre><code>                                         address latitude longitude
1 19 rue Michel Bakounine, 29600 Morlaix, France 48.59042 -3.816429
2              8 place Paul Ricoeur, 75013 Paris 48.82673  2.382450
                           result_label result_score result_type                result_id
1 19 Rue Michel Bakounine 29600 Morlaix         0.78 housenumber ADRNIVX_0000000266085152
2      8 Place Paul Ricoeur 75013 Paris         0.93 housenumber ADRNIVX_0000000331930326
  result_housenumber          result_name result_street result_postcode result_city
1                 19 Rue Michel Bakounine          &lt;NA&gt;           29600     Morlaix
2                  8   Place Paul Ricoeur          &lt;NA&gt;           75013       Paris
            result_context result_citycode
1  29, Finistère, Bretagne           29151
2 75, Paris, Île-de-France           75113</code></pre>
<p><strong>Transformer les données en objet <code>sf</code></strong></p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="chapitre1.html#cb63-1"></a><span class="kw">library</span>(sf)</span>
<span id="cb63-2"><a href="chapitre1.html#cb63-2"></a><span class="kw">library</span>(cartography)</span>
<span id="cb63-3"><a href="chapitre1.html#cb63-3"></a>place_sf &lt;-<span class="st"> </span><span class="kw">st_as_sf</span>(place, <span class="dt">coords =</span> <span class="kw">c</span>(<span class="st">&quot;longitude&quot;</span>, <span class="st">&quot;latitude&quot;</span>), <span class="dt">crs =</span> <span class="dv">4326</span>)</span>
<span id="cb63-4"><a href="chapitre1.html#cb63-4"></a>osm_fr &lt;-<span class="st"> </span><span class="kw">getTiles</span>(<span class="dt">x =</span> place_sf, <span class="dt">zoom =</span> <span class="dv">7</span> )</span>
<span id="cb63-5"><a href="chapitre1.html#cb63-5"></a><span class="kw">tilesLayer</span>(osm_fr)</span>
<span id="cb63-6"><a href="chapitre1.html#cb63-6"></a><span class="kw">plot</span>(<span class="kw">st_geometry</span>(place_sf), <span class="dt">pch =</span> <span class="dv">20</span>, <span class="dt">cex =</span> <span class="dv">4</span>, <span class="dt">col =</span> <span class="st">&quot;red&quot;</span>, <span class="dt">add=</span>T)</span></code></pre></div>
<p><img src="Cartographie_avec_R_files/figure-html/adddisplay-1.png" width="460.8" style="display: block; margin: auto;" /></p>
</div>
<div id="importer-des-données-osm" class="section level2">
<h2><span class="header-section-number">1.5</span> Importer des données OSM</h2>
<p><a href="https://www.openstreetmap.org" target="_blank">OpenStreetMap (OSM)</a> est un projet de cartographie participative qui a pour but de constituer une base de données géographiques libre à l’échelle mondiale. OpenStreetMap vous permet de voir, modifier et utiliser des données géographiques dans le Monde entier.</p>
<p>Le package <code>osmdata</code> <span class="citation">(Padgham et al. <a href="#ref-R-osmdata" role="doc-biblioref">2017</a>)</span> permet d’extraire des données vectorielles depuis OSM.</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="chapitre1.html#cb64-1"></a><span class="kw">library</span>(sf)</span>
<span id="cb64-2"><a href="chapitre1.html#cb64-2"></a><span class="kw">library</span>(osmdata)</span>
<span id="cb64-3"><a href="chapitre1.html#cb64-3"></a><span class="kw">library</span>(sf)</span>
<span id="cb64-4"><a href="chapitre1.html#cb64-4"></a>mtq &lt;-<span class="st"> </span><span class="kw">st_read</span>(<span class="kw">system.file</span>(<span class="st">&quot;gpkg/mtq.gpkg&quot;</span>, <span class="dt">package=</span><span class="st">&quot;cartography&quot;</span>), </span>
<span id="cb64-5"><a href="chapitre1.html#cb64-5"></a>               <span class="dt">quiet =</span> <span class="ot">TRUE</span>)</span>
<span id="cb64-6"><a href="chapitre1.html#cb64-6"></a><span class="co"># Définition d&#39;une bounding box</span></span>
<span id="cb64-7"><a href="chapitre1.html#cb64-7"></a>q &lt;-<span class="st"> </span><span class="kw">opq</span>(<span class="dt">bbox=</span><span class="kw">st_bbox</span>(<span class="kw">st_transform</span>(mtq,<span class="dv">4326</span>)))</span>
<span id="cb64-8"><a href="chapitre1.html#cb64-8"></a><span class="co"># Extraction des restaurants</span></span>
<span id="cb64-9"><a href="chapitre1.html#cb64-9"></a>res &lt;-<span class="st"> </span><span class="kw">add_osm_feature</span>(<span class="dt">opq =</span> q, <span class="dt">key =</span> <span class="st">&#39;amenity&#39;</span>, <span class="dt">value =</span> <span class="st">&quot;restaurant&quot;</span>)</span>
<span id="cb64-10"><a href="chapitre1.html#cb64-10"></a>res.sf &lt;-<span class="st"> </span><span class="kw">osmdata_sf</span>(res)</span>
<span id="cb64-11"><a href="chapitre1.html#cb64-11"></a>res.sf.pts  &lt;-<span class="st"> </span>res.sf<span class="op">$</span>osm_points[<span class="op">!</span><span class="kw">is.na</span>(res.sf<span class="op">$</span>osm_points<span class="op">$</span>amenity),]</span>
<span id="cb64-12"><a href="chapitre1.html#cb64-12"></a>resto &lt;-<span class="st"> </span><span class="kw">st_transform</span>(res.sf.pts, <span class="kw">st_crs</span>(mtq))</span>
<span id="cb64-13"><a href="chapitre1.html#cb64-13"></a><span class="co"># Affichage des restaurants</span></span>
<span id="cb64-14"><a href="chapitre1.html#cb64-14"></a><span class="kw">plot</span>(<span class="kw">st_geometry</span>(mtq), <span class="dt">col=</span><span class="st">&quot;darkseagreen3&quot;</span>, <span class="dt">border=</span><span class="st">&quot;darkseagreen4&quot;</span>,  </span>
<span id="cb64-15"><a href="chapitre1.html#cb64-15"></a>     <span class="dt">bg =</span> <span class="st">&quot;lightblue1&quot;</span>)</span>
<span id="cb64-16"><a href="chapitre1.html#cb64-16"></a><span class="kw">plot</span>(<span class="kw">st_geometry</span>(resto), <span class="dt">add=</span><span class="ot">TRUE</span>, <span class="dt">pch=</span><span class="dv">20</span>, <span class="dt">col =</span> <span class="st">&quot;#330A5FFF&quot;</span>, <span class="dt">cex =</span> <span class="fl">0.5</span>)</span>
<span id="cb64-17"><a href="chapitre1.html#cb64-17"></a><span class="kw">title</span>(<span class="st">&quot;Répartition des restaurants&quot;</span>)</span>
<span id="cb64-18"><a href="chapitre1.html#cb64-18"></a><span class="kw">mtext</span>(<span class="dt">text =</span> <span class="st">&quot;INSEE, 2016 - OSM, 2019&quot;</span>,<span class="dt">side =</span> <span class="dv">1</span>, <span class="dt">line =</span> <span class="dv">-1</span>, <span class="dt">cex =</span> <span class="fl">0.8</span>)</span></code></pre></div>
<p><img src="Cartographie_avec_R_files/figure-html/unnamed-chunk-19-1.png" width="460.8" style="display: block; margin: auto;" /></p>
</div>
<div id="exercices" class="section level2">
<h2><span class="header-section-number">1.6</span> Exercices</h2>
<p><a href="https://rcarto.github.io/carto_avec_r_exo/#1_traitement_de_donn%C3%A9es_spatiales">Exercices de traitement de données spatiales</a></p>

</div>
</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-R-photon">
<p>Giraud, Timothée. 2017b. <em>Photon: Geocode Locations with Photon Api</em>. <a href="https://github.com/rCarto/photon">https://github.com/rCarto/photon</a>.</p>
</div>
<div id="ref-R-banR">
<p>Gombin, Joel, and Paul-Antoine Chevalier. 2017. <em>BanR: R Client for the Ban Api</em>. <a href="https://CRAN.R-project.org/package=banR">https://CRAN.R-project.org/package=banR</a>.</p>
</div>
<div id="ref-R-osmdata">
<p>Padgham, Mark, Bob Rudis, Robin Lovelace, and Maëlle Salmon. 2017. “Osmdata.” <em>The Journal of Open Source Software</em> 2 (14). <a href="https://doi.org/10.21105/joss.00305">https://doi.org/10.21105/joss.00305</a>.</p>
</div>
<div id="ref-R-sf">
<p>Pebesma, Edzer. 2018a. <em>Sf: Simple Features for R</em>. <a href="https://CRAN.R-project.org/package=sf">https://CRAN.R-project.org/package=sf</a>.</p>
</div>
<div id="ref-Pebesma18">
<p>Pebesma, Edzer. 2018b. “Simple Features for R: Standardized Support for Spatial Vector Data.” <em>The R Journal</em>. <a href="https://journal.r-project.org/archive/2018/RJ-2018-009/index.html">https://journal.r-project.org/archive/2018/RJ-2018-009/index.html</a>.</p>
</div>
<div id="ref-R-nominatim">
<p>Rudis, Bob. 2019. <em>Nominatim: Tools for Working with the ’Nominatim’ Api</em>.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="chapitre2.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": {},
"google": false
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["Cartographie_avec_R.pdf"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
